---
import { Image } from 'astro:assets'
import { CloudinaryFolders, getImages } from '../libs/cloudinary'
import Card from './Card.astro'
import SectionTitle from './SectionTitle.astro'
import VideoCard from './VideoCard.astro'

const { id, class: className } = Astro.props

let youtubeVideos = []
try {
  const response = await fetch(`${Astro.url.origin}/api/youtube`)
  if (response.ok) {
    const data = await response.json()
    youtubeVideos = data.videos || []
  }
} catch (error) {
  console.error('Error fetching YouTube videos:', error)
}

const images = await getImages({ cantidad: 3, folder: CloudinaryFolders.Novedades })

---

  <section id={id} class={`spacing-section ${className || ''}`}>
    <div class='mx-auto gap-6 w-11/12 md:w-10/12 3xl:w-7/12'>

      <SectionTitle
        title='Novedades y Videos'
        subtitle='Mantente al día con nuestras últimas novedades, videos y contenido del canal'
      />

      <div class='grid-responsive'>

        {images.length > 0 &&
        images.map((image) => (
          <Card key={image.id} class='flex items-center justify-center !p-0'>
            <Image
              src={image.original}
              alt={image.alt}
              inferSize
            />
          </Card>
        ))}

        <VideoCard
          video={{
            id: 'k9ewVCfSfKw',
            channelTitle: 'iRacingOfficial',
            publishedAt: '2025-08-16T00:00:00Z',
            url: 'https://www.youtube.com/watch?v=k9ewVCfSfKw',
            title: 'Clip histórico: Retransmisión oficial iRacing',
            description: 'Este clip recoge uno de los momentos históricos del equipo Endurance Enjoyers. ¡Revívelo y compártelo!',
            thumbnail: 'https://img.youtube.com/vi/k9ewVCfSfKw/hqdefault.jpg'
          }} start={4112} end={4172}
        />

        {youtubeVideos.length > 0
          ? youtubeVideos.map((video) => (
            <VideoCard
              key={video.id}
              video={video}
            />
          ))
          : (
            <>
                <!-- Contenido de fallback si no hay videos -->
              <Card
                title='Próxima Carrera de Resistencia'
                description='¡Nos complace anunciar la próxima carrera de resistencia que se llevará a cabo pronto!'
                date='Próximamente'
                icon='calendar'
                iconColor='bg-orange-500'
              />

              <Card
                title='Contenido de YouTube'
                description='Suscríbete a nuestro canal de YouTube para ver los últimos videos sobre sim racing y carreras de resistencia.'
                date='Videos semanales'
                icon='trophy'
                iconColor='bg-red-500'
              />
            </>
            )}

          <!-- Card de suscripción siempre visible -->
        <Card class='sm:col-span-2 lg:col-span-1'>
          <div class='text-center py-4 md:py-6 lg:py-8'>
            <div class='w-12 h-12 md:w-16 md:h-16 bg-gradient-to-r from-red-500 to-red-600 rounded-full flex items-center justify-center mx-auto mb-4'>
              <svg class='w-6 h-6 md:w-8 md:h-8 text-white' fill='currentColor' viewBox='0 0 24 24'>
                <path d='M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z' />
              </svg>
            </div>
            <h3 class='text-lg md:text-xl font-semibold text-text-primary mb-2'>¡Suscríbete!</h3>
            <p class='text-sm md:text-base text-text-secondary mb-4'>No te pierdas nuestros últimos videos</p>
            <a
              href='https://www.youtube.com/@Sayk365'
              target='_blank'
              rel='noopener noreferrer'
              class='inline-block bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold px-4 md:px-6 py-2 text-sm md:text-base rounded-lg transition-all duration-300 transform hover:scale-105'
            >
              Ver Canal de Sayk
            </a>
            <a
              href='https://www.youtube.com/@thejerbo2250'
              target='_blank'
              rel='noopener noreferrer'
              class='mt-3 inline-block bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold px-4 md:px-6 py-2 text-sm md:text-base rounded-lg transition-all duration-300 transform hover:scale-105'
            >
              Ver Canal de Jerbo
            </a>
          </div>
        </Card>

      </div>
    </div>
  </section>
