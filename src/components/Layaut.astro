---
import Analytics from '@vercel/analytics/astro'
import SpeedInsights from '@vercel/speed-insights/astro'
import '../styles/global.css'
import Footer from './Footer.astro'
import Header from './Header.astro'

const {
  title = 'Endurance Enjoyers | Equipo español de resistencia iRacing',
  description = 'Únete a Endurance Enjoyers, la comunidad de sim racing especializada en carreras de resistencia en iRacing. Experiencias únicas, eventos exclusivos y pasión por las carreras de larga duración.',
  keywords = 'iRacing, carreras resistencia, endurance racing, 24 horas Daytona, Le Mans, equipo carreras, simulador carreras, simracing, motorsport virtual, España, iRacing calendar, calendario iRacing',
  ogImage = '/og-image.png',
  canonicalUrl,
  showHeader = false
} = Astro.props

const currentUrl = canonicalUrl || Astro.url.href
const fullOgImage = new URL(ogImage, Astro.url.origin).href

// Generar JSON-LD manualmente para evitar problemas en el build
const contactUrl = new URL('/#contacto', Astro.url.origin).href

const jsonLD = `{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebPage",
      "@id": "${currentUrl}",
      "url": "${currentUrl}",
      "name": "${title}",
      "isPartOf": {"@id": "${Astro.url.origin}/#website"},
      "about": {"@id": "${Astro.url.origin}/#organization"},
      "primaryImageOfPage": {"@id": "${currentUrl}#primaryimage"},
      "image": {"@id": "${currentUrl}#primaryimage"},
      "thumbnailUrl": "${fullOgImage}",
      "datePublished": "2024-01-01T00:00:00+00:00",
      "dateModified": "${new Date().toISOString()}",
      "description": "${description.replace(/"/g, '\\"')}",
      "inLanguage": "es-ES",
      "potentialAction": [
        {
          "@type": "ReadAction",
          "target": ["${currentUrl}"]
        }
      ]
    },
    {
      "@type": "ImageObject",
      "inLanguage": "es-ES",
      "@id": "${currentUrl}#primaryimage",
      "url": "${fullOgImage}",
      "contentUrl": "${fullOgImage}",
      "width": 1200,
      "height": 630,
      "caption": "Endurance Enjoyers - Equipo de Sim Racing"
    },
    {
      "@type": "WebSite",
      "@id": "${Astro.url.origin}/#website",
      "url": "${Astro.url.origin}/",
      "name": "Endurance Enjoyers",
      "description": "Comunidad premium de sim racing especializada en carreras de resistencia en iRacing",
      "publisher": {"@id": "${Astro.url.origin}/#organization"},
      "potentialAction": [
        {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "${Astro.url.origin}/?s={search_term_string}"
          },
          "query-input": {
            "@type": "PropertyValueSpecification",
            "valueRequired": true,
            "valueName": "search_term_string"
          }
        }
      ],
      "inLanguage": "es-ES"
    },
    {
      "@type": "SportsTeam",
      "@id": "${Astro.url.origin}/#organization",
      "name": "Endurance Enjoyers",
      "alternateName": "EnduEnjoyers",
      "url": "${Astro.url.origin}/",
      "logo": {
        "@type": "ImageObject",
        "inLanguage": "es-ES",
        "@id": "${Astro.url.origin}/#logo",
        "url": "${new URL('/logo.webp', Astro.url.origin).href}",
        "contentUrl": "${new URL('/logo.webp', Astro.url.origin).href}",
        "width": 512,
        "height": 512,
        "caption": "Endurance Enjoyers Logo"
      },
      "image": {"@id": "${Astro.url.origin}/#logo"},
      "description": "${description.replace(/"/g, '\\"')}",
      "sport": "Motor Racing",
      "subOrganization": "iRacing Endurance Racing",
      "foundingDate": "2024",
      "memberOf": {
        "@type": "Organization",
        "name": "iRacing",
        "url": "https://www.iracing.com"
      },
      "sameAs": [
        "https://x.com/EnduEnjoyers"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "Team Recruitment",
        "availableLanguage": ["Spanish", "English"],
        "url": "${contactUrl}"
      },
      "areaServed": {
        "@type": "Country",
        "name": "Spain"
      },
      "knowsAbout": [
        "iRacing",
        "Endurance Racing",
        "24 Hours of Daytona",
        "24 Hours of Le Mans",
        "Motorsport Simulation",
        "Sim Racing",
        "Virtual Motorsport",
        "Carreras de Resistencia",
        "Simulador de Carreras",
        "Competición Virtual",
        "Calendario de iRacing"
      ],
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5",
        "bestRating": "5",
        "ratingCount": "15"
      }
    }
  ]
}`
---
  <html lang='es'>
    <head>
      <title>{title}</title>
      <meta charset='UTF-8' />
      <meta name='viewport' content='width=device-width, initial-scale=1.0' />
      <meta name='description' content={description} />
      <meta name='keywords' content={keywords} />
      <meta name='robots' content='index, follow' />
      <meta name='author' content='Endurance Enjoyers' />
      <meta name='publisher' content='Endurance Enjoyers' />
      <meta name='theme-color' content='#171915' />
      <meta name='generator' content={Astro.generator} />

      <!-- Canonical URL -->
      <link rel='canonical' href={currentUrl} />

      <!-- Forzar HTTPS -->
      <meta http-equiv='Content-Security-Policy' content='upgrade-insecure-requests' />

      <!-- Open Graph -->
      <meta property='og:title' content={title} />
      <meta property='og:description' content={description} />
      <meta property='og:type' content='website' />
      <meta property='og:url' content={currentUrl} />
      <meta property='og:image' content={fullOgImage} />
      <meta property='og:image:width' content='1200' />
      <meta property='og:image:height' content='630' />
      <meta property='og:image:type' content='image/png' />
      <meta property='og:site_name' content='Endurance Enjoyers' />
      <meta property='og:locale' content='es_ES' />

      <!-- Twitter Cards -->
      <meta name='twitter:card' content='summary_large_image' />
      <meta name='twitter:site' content='@EnduEnjoyers' />
      <meta name='twitter:title' content={title} />
      <meta name='twitter:description' content={description} />
      <meta name='twitter:image' content={fullOgImage} />

      <!-- Preload critical resources -->
      <link rel='preload' href='/logotextclear.webp' as='image' type='image/webp' />

      <!-- Preconnect to external domains -->
      <link rel='preconnect' href='https://res.cloudinary.com' />
      <link rel='dns-prefetch' href='https://res.cloudinary.com' />
      <link rel='preconnect' href='https://fonts.googleapis.com' />
      <link rel='dns-prefetch' href='https://fonts.googleapis.com' />

      <!-- Icons optimizados con múltiples tamaños -->
      <link rel='icon' type='image/x-icon' href='/favicon.ico' sizes='16x16 24x24 32x32 48x48 64x64' />
      <link rel='icon' type='image/png' href='/og-image.png' sizes='192x192' />
      <link rel='apple-touch-icon' href='/og-image.png' sizes='180x180' />
      <link rel='apple-touch-icon' href='/og-image.png' sizes='152x152' />
      <link rel='apple-touch-icon' href='/og-image.png' sizes='120x120' />
      <link rel='manifest' href='/site.webmanifest' />

      <!-- JSON-LD Structured Data -->
      <script type='application/ld+json' set:html={jsonLD} />
    </head>
    <body class='flex flex-col min-h-screen'>
      {showHeader && <Header />}
      <div class='flex-grow'>
        <slot />
        <Analytics />
        <SpeedInsights />
      </div>
      <Footer />
    </body>
  </html>
